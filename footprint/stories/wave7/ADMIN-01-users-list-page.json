{
  "$schema": "../../../planning/schemas/story-schema-v4.2.json",
  "schema_version": "4.2",
  "story_id": "ADMIN-01",
  "type": "feature",
  "wave_number": 7,
  "title": "Admin Users List Page",
  "domain": "frontend",
  "agent": "fe-dev",
  "priority": "high",
  "story_points": 5,
  "description": "Create admin users management page with list view, search, filtering, and quick actions for user management",
  "status": "pending",

  "objective": {
    "as_a": "Footprint admin",
    "i_want": "to view and search all registered users",
    "so_that": "I can manage user accounts and monitor platform usage"
  },

  "acceptance_criteria": [
    {
      "id": "AC-001",
      "description": "Page displays paginated list of all users",
      "ears_format": "WHEN admin navigates to /admin/users THEN paginated user list displays with default 20 users per page",
      "test_approach": "Mock useAdminUsers hook with users, verify table rendered with pagination"
    },
    {
      "id": "AC-002",
      "description": "Page shows loading spinner while fetching users",
      "ears_format": "WHEN page is loading user data THEN display loading spinner in center of content area",
      "test_approach": "Set isLoading=true in mock, verify spinner visible"
    },
    {
      "id": "AC-003",
      "description": "Page shows empty state when no users match filters",
      "ears_format": "WHEN search/filter returns zero results THEN display empty state with 'לא נמצאו משתמשים' message",
      "test_approach": "Mock empty users array, verify empty state message"
    },
    {
      "id": "AC-004",
      "description": "Each user row shows email, name, registration date, order count, role",
      "ears_format": "WHEN user row renders THEN display email, name, createdAt date, orderCount, and admin badge if applicable",
      "test_approach": "Verify user row contains all required fields"
    },
    {
      "id": "AC-005",
      "description": "Admin users are visually distinguished with badge",
      "ears_format": "WHEN user has isAdmin=true THEN display purple 'מנהל' badge next to name",
      "test_approach": "Mock user with isAdmin=true, verify admin badge displayed"
    },
    {
      "id": "AC-006",
      "description": "Search input filters users by email or name",
      "ears_format": "WHEN admin types in search input THEN filter users matching email or name after 300ms debounce",
      "threshold": "debounce: 300ms",
      "test_approach": "Type in search, verify API called with search param"
    },
    {
      "id": "AC-007",
      "description": "Filter tabs for All, Active, Admin users",
      "ears_format": "WHEN admin clicks filter tab THEN update list to show only users matching selected role filter",
      "test_approach": "Click filter tab, verify API called with role filter"
    },
    {
      "id": "AC-008",
      "description": "Sort by registration date, order count, name",
      "ears_format": "WHEN admin clicks sortable column header THEN sort list by that column, toggle direction on repeat click",
      "test_approach": "Click column header, verify sort order changes"
    },
    {
      "id": "AC-009",
      "description": "Click user row navigates to user detail page",
      "ears_format": "WHEN admin clicks user row THEN navigate to /admin/users/[id] detail page",
      "test_approach": "Click row, verify navigation to /admin/users/[id]"
    },
    {
      "id": "AC-010",
      "description": "Quick action menu with View, Make Admin, Deactivate options",
      "ears_format": "WHEN admin clicks action button on row THEN display dropdown with 'צפייה', 'הפוך למנהל', 'השבת' options",
      "test_approach": "Click action button, verify dropdown menu appears"
    },
    {
      "id": "AC-011",
      "description": "Stats cards show total users, new this week, admin count",
      "ears_format": "WHEN page loads THEN display stats cards showing totalUsers, newThisWeek, adminCount values",
      "test_approach": "Verify stats cards rendered with correct values"
    },
    {
      "id": "AC-012",
      "description": "Page is fully RTL with Hebrew labels",
      "ears_format": "WHEN page renders THEN container has dir='rtl' and all labels display in Hebrew",
      "test_approach": "Verify dir='rtl' and Hebrew text for all labels"
    },
    {
      "id": "AC-013",
      "description": "Page is mobile-first responsive",
      "ears_format": "WHEN viewport width < 768px THEN table converts to card layout with stacked fields",
      "test_approach": "Verify responsive classes on container and table"
    },
    {
      "id": "AC-014",
      "description": "Pagination controls for page navigation",
      "ears_format": "WHEN admin clicks pagination control THEN load corresponding page of results",
      "test_approach": "Click next page, verify API called with page param"
    }
  ],

  "files": {
    "create": [
      "app/admin/users/page.tsx",
      "app/admin/users/page.test.tsx",
      "components/admin/UsersList.tsx",
      "components/admin/UsersList.test.tsx",
      "components/admin/UserRow.tsx",
      "components/admin/UserRow.test.tsx",
      "hooks/useAdminUsers.ts",
      "hooks/useAdminUsers.test.ts"
    ],
    "modify": [],
    "forbidden": [
      "app/api/admin/users/*",
      "lib/auth/admin.ts"
    ]
  },

  "technical_requirements": {
    "reuse_components": [
      "components/ui/Input.tsx",
      "components/ui/Button.tsx",
      "components/ui/Badge.tsx",
      "components/ui/Table.tsx",
      "components/ui/Dropdown.tsx"
    ],
    "hooks": [
      "useAdminUsers - fetch paginated users with filters"
    ],
    "state_management": "React Query for server state"
  },

  "tdd": {
    "test_framework": "vitest",
    "test_files": [
      "app/admin/users/page.test.tsx",
      "components/admin/UsersList.test.tsx",
      "components/admin/UserRow.test.tsx",
      "hooks/useAdminUsers.test.ts"
    ],
    "coverage_target": 90,
    "test_categories": [
      {
        "name": "Loading State",
        "count": 2,
        "examples": [
          "should show loading spinner while fetching",
          "should hide loading after fetch completes"
        ]
      },
      {
        "name": "Empty State",
        "count": 2,
        "examples": [
          "should show empty message when no users",
          "should show empty message when filter has no results"
        ]
      },
      {
        "name": "Users List",
        "count": 5,
        "examples": [
          "should render all users in table",
          "should highlight admin users with badge",
          "should show user details on each row",
          "should navigate to detail on row click",
          "should show quick action menu"
        ]
      },
      {
        "name": "Search & Filter",
        "count": 4,
        "examples": [
          "should filter by search query",
          "should filter by role tab",
          "should combine search and filter",
          "should debounce search input"
        ]
      },
      {
        "name": "Sorting",
        "count": 3,
        "examples": [
          "should sort by registration date",
          "should sort by order count",
          "should toggle sort direction"
        ]
      },
      {
        "name": "Pagination",
        "count": 3,
        "examples": [
          "should show pagination controls",
          "should navigate between pages",
          "should update page size"
        ]
      },
      {
        "name": "Stats Cards",
        "count": 2,
        "examples": [
          "should display total user count",
          "should display admin count"
        ]
      },
      {
        "name": "RTL & Accessibility",
        "count": 3,
        "examples": [
          "should have dir=rtl on container",
          "should use Hebrew labels",
          "should have proper ARIA attributes"
        ]
      }
    ],
    "mocking_strategy": {
      "hooks": "vi.mock('@/hooks/useAdminUsers')",
      "navigation": "vi.mock('next/navigation')"
    }
  },

  "hazard_analysis": {
    "identified_hazards": [
      {
        "id": "HAZ-001",
        "description": "User data exposure to non-admin users",
        "severity": "critical",
        "likelihood": "remote",
        "mitigation": "Verify admin role in useAdminUsers hook before fetching, API enforces admin check"
      },
      {
        "id": "HAZ-002",
        "description": "PII displayed without proper access control",
        "severity": "major",
        "likelihood": "remote",
        "mitigation": "Page wrapped in admin auth check, redirect non-admins to 403"
      }
    ],
    "risk_level": "medium"
  },

  "safety": {
    "stop_conditions": [
      "Any modification to authentication middleware",
      "Changes to API endpoints"
    ],
    "escalation_triggers": [
      "User data exposure to non-admins",
      "Role escalation vulnerabilities"
    ],
    "rollback_plan": "Delete new admin user components and page files"
  },

  "dependencies": {
    "required_before": ["ADMIN-02"],
    "blocks": ["ADMIN-04"]
  },

  "traceability": {
    "requirements": ["PRD-ADMIN-USER-MGMT"],
    "epic": "ADMIN-USERS",
    "related_stories": ["ADMIN-02", "ADMIN-03", "ADMIN-04"]
  },

  "metadata": {
    "created_at": "2026-02-01T12:00:00Z",
    "created_by": "claude-opus-4-5"
  },

  "estimated_tests": 24
}
