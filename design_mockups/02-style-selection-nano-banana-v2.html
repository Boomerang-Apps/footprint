<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Footprint - Nano Banana Style Studio</title>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --primary: #7c3aed;
      --primary-light: #a78bfa;
      --accent: #ec4899;
      --success: #10b981;
      --error: #ef4444;
      --warning: #f59e0b;
      --gray-50: #fafafa;
      --gray-100: #f4f4f5;
      --gray-200: #e4e4e7;
      --gray-300: #d4d4d8;
      --gray-400: #a1a1aa;
      --gray-500: #71717a;
      --gray-600: #52525b;
      --gray-700: #3f3f46;
      --gray-800: #27272a;
      --gray-900: #18181b;
      --white: #ffffff;
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
      --shadow-md: 0 4px 6px rgba(0,0,0,0.07), 0 2px 4px rgba(0,0,0,0.06);
      --shadow-lg: 0 10px 15px rgba(0,0,0,0.1), 0 4px 6px rgba(0,0,0,0.05);
      --shadow-xl: 0 20px 25px rgba(0,0,0,0.1), 0 10px 10px rgba(0,0,0,0.04);
    }

    body {
      font-family: 'Heebo', system-ui, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: var(--gray-900);
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Header */
    .header {
      text-align: center;
      padding: 30px 20px;
      color: white;
    }
    .header h1 {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 8px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .header p {
      font-size: 16px;
      opacity: 0.9;
    }

    /* API Config */
    .api-config {
      background: rgba(255,255,255,0.95);
      border-radius: 16px;
      padding: 16px 20px;
      margin-bottom: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-md);
    }
    .api-config label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 500;
    }
    .api-config input {
      padding: 10px 14px;
      border: 2px solid var(--gray-200);
      border-radius: 10px;
      font-size: 14px;
      width: 320px;
      transition: border-color 0.2s;
    }
    .api-config input:focus {
      outline: none;
      border-color: var(--primary);
    }
    .api-btn {
      padding: 10px 20px;
      background: var(--primary);
      color: white;
      border-radius: 10px;
      font-weight: 600;
      font-size: 14px;
      transition: transform 0.1s, background 0.2s;
    }
    .api-btn:hover { background: #6d28d9; }
    .api-btn:active { transform: scale(0.98); }
    .api-status {
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    .api-status.ready { background: var(--success); color: white; }
    .api-status.error { background: var(--error); color: white; }
    .api-status.waiting { background: var(--gray-300); color: var(--gray-700); }

    /* Main Layout */
    .main-grid {
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 24px;
    }
    @media (max-width: 900px) {
      .main-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Image Panel */
    .image-panel {
      background: white;
      border-radius: 24px;
      padding: 24px;
      box-shadow: var(--shadow-xl);
    }

    /* Upload Area */
    .upload-area {
      border: 3px dashed var(--gray-300);
      border-radius: 20px;
      padding: 40px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      background: var(--gray-50);
    }
    .upload-area:hover {
      border-color: var(--primary);
      background: rgba(124, 58, 237, 0.05);
    }
    .upload-area.dragover {
      border-color: var(--primary);
      background: rgba(124, 58, 237, 0.1);
      transform: scale(1.02);
    }
    .upload-area.has-image {
      display: none;
    }
    .upload-icon {
      width: 64px;
      height: 64px;
      margin: 0 auto 16px;
      color: var(--gray-400);
    }
    .upload-area h3 {
      font-size: 18px;
      margin-bottom: 8px;
      color: var(--gray-700);
    }
    .upload-area p {
      font-size: 14px;
      color: var(--gray-500);
    }
    #fileInput { display: none; }

    /* Comparison Container */
    .comparison-wrapper {
      display: none;
    }
    .comparison-wrapper.visible {
      display: block;
    }
    .comparison-container {
      position: relative;
      width: 100%;
      aspect-ratio: 4/5;
      border-radius: 20px;
      overflow: hidden;
      background: var(--gray-100);
      box-shadow: var(--shadow-lg);
    }
    .comparison-image {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .comparison-original { z-index: 1; }
    .comparison-transformed {
      z-index: 2;
      clip-path: inset(0 0 0 50%);
    }
    .comparison-slider {
      position: absolute;
      top: 0;
      bottom: 0;
      left: 50%;
      width: 4px;
      background: white;
      z-index: 10;
      cursor: ew-resize;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    .comparison-slider::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 44px;
      height: 44px;
      background: white;
      border-radius: 50%;
      box-shadow: var(--shadow-md);
    }
    .comparison-slider::after {
      content: '‚Üî';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 20px;
      color: var(--gray-600);
    }
    .comparison-label {
      position: absolute;
      bottom: 16px;
      padding: 8px 16px;
      background: rgba(0,0,0,0.75);
      color: white;
      font-size: 13px;
      font-weight: 600;
      border-radius: 24px;
      z-index: 5;
    }
    .comparison-label.original { left: 16px; }
    .comparison-label.transformed { right: 16px; }

    /* Loading Overlay */
    .loading-overlay {
      position: absolute;
      inset: 0;
      background: rgba(255,255,255,0.95);
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 16px;
      z-index: 20;
      border-radius: 20px;
    }
    .loading-overlay.show { display: flex; }
    .spinner {
      width: 56px;
      height: 56px;
      border: 4px solid var(--gray-200);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading-text { font-size: 16px; font-weight: 500; color: var(--gray-700); }
    .loading-subtext { font-size: 13px; color: var(--gray-500); }

    /* Image Actions */
    .image-actions {
      display: flex;
      gap: 12px;
      margin-top: 16px;
    }
    .image-actions button {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s;
    }
    .btn-change {
      background: var(--gray-100);
      color: var(--gray-700);
    }
    .btn-change:hover { background: var(--gray-200); }
    .btn-download {
      background: var(--primary);
      color: white;
    }
    .btn-download:hover { background: #6d28d9; }
    .btn-download:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Styles Panel */
    .styles-panel {
      background: white;
      border-radius: 24px;
      padding: 24px;
      box-shadow: var(--shadow-xl);
    }
    .styles-panel h2 {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 8px;
      text-align: center;
    }
    .styles-panel p {
      font-size: 14px;
      color: var(--gray-500);
      text-align: center;
      margin-bottom: 20px;
    }

    /* Style Grid */
    .style-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }
    .style-card {
      background: var(--gray-50);
      border: 3px solid transparent;
      border-radius: 16px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }
    .style-card:hover {
      background: white;
      border-color: var(--gray-200);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }
    .style-card.selected {
      border-color: var(--primary);
      background: rgba(124, 58, 237, 0.05);
    }
    .style-card.processing {
      opacity: 0.7;
      pointer-events: none;
    }
    .style-icon {
      width: 56px;
      height: 56px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 12px;
      color: white;
    }
    .style-icon svg {
      width: 28px;
      height: 28px;
      stroke: currentColor;
      stroke-width: 2;
      fill: none;
    }
    .style-name {
      font-size: 14px;
      font-weight: 600;
      color: var(--gray-800);
      margin-bottom: 4px;
    }
    .style-desc {
      font-size: 11px;
      color: var(--gray-500);
      line-height: 1.3;
    }

    /* Style Colors */
    .style-pop-art .style-icon { background: linear-gradient(135deg, #8b5cf6, #ec4899); }
    .style-watercolor .style-icon { background: linear-gradient(135deg, #3b82f6, #06b6d4); }
    .style-line-art .style-icon { background: linear-gradient(135deg, #6b7280, #9ca3af); }
    .style-oil-painting .style-icon { background: linear-gradient(135deg, #f59e0b, #d97706); }
    .style-romantic .style-icon { background: linear-gradient(135deg, #ec4899, #f472b6); }
    .style-comic-book .style-icon { background: linear-gradient(135deg, #f97316, #ef4444); }
    .style-vintage .style-icon { background: linear-gradient(135deg, #92400e, #b45309); }
    .style-enhanced .style-icon { background: linear-gradient(135deg, #10b981, #34d399); }

    /* Info Box */
    .info-box {
      margin-top: 20px;
      padding: 16px;
      background: linear-gradient(135deg, rgba(124,58,237,0.1), rgba(236,72,153,0.1));
      border-radius: 12px;
      font-size: 12px;
      color: var(--gray-600);
    }
    .info-box strong { color: var(--gray-800); }
    .info-box code {
      background: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
    }

    /* Error Message */
    .error-message {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid var(--error);
      color: var(--error);
      padding: 12px 16px;
      border-radius: 12px;
      margin-top: 16px;
      font-size: 13px;
      display: none;
    }
    .error-message.show { display: block; }

    /* Processing Info */
    .processing-info {
      margin-top: 16px;
      padding: 12px;
      background: var(--gray-50);
      border-radius: 12px;
      font-size: 12px;
      color: var(--gray-600);
      display: none;
    }
    .processing-info.show { display: block; }
    .processing-info .stat {
      display: flex;
      justify-content: space-between;
      padding: 4px 0;
    }
    .processing-info .stat-label { color: var(--gray-500); }
    .processing-info .stat-value { font-weight: 600; color: var(--gray-800); }
  </style>
</head>
<body>
  <!-- SVG Icons -->
  <svg style="display:none">
    <defs>
      <symbol id="i-upload" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></symbol>
      <symbol id="i-zap" viewBox="0 0 24 24"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></symbol>
      <symbol id="i-droplet" viewBox="0 0 24 24"><path d="M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z"/></symbol>
      <symbol id="i-pen" viewBox="0 0 24 24"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></symbol>
      <symbol id="i-brush" viewBox="0 0 24 24"><path d="m9.06 11.9 8.07-8.06a2.85 2.85 0 1 1 4.03 4.03l-8.06 8.08"/><path d="M7.07 14.94c-1.66 0-3 1.35-3 3.02 0 1.33-2.5 1.52-2 2.02 1.08 1.1 2.49 2.02 4 2.02 2.2 0 4-1.8 4-4.04a3.01 3.01 0 0 0-3-3.02z"/></symbol>
      <symbol id="i-heart" viewBox="0 0 24 24"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></symbol>
      <symbol id="i-film" viewBox="0 0 24 24"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M7 3v18M17 3v18"/></symbol>
      <symbol id="i-sun" viewBox="0 0 24 24"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></symbol>
      <symbol id="i-download" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></symbol>
      <symbol id="i-refresh" viewBox="0 0 24 24"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M3 21v-5h5"/></symbol>
    </defs>
  </svg>

  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>üçå Nano Banana Style Studio</h1>
      <p>Transform your photos with AI-powered artistic styles</p>
    </div>

    <!-- API Config -->
    <div class="api-config">
      <label>
        Google AI API Key:
        <input type="password" id="apiKey" placeholder="Enter your API key..." />
      </label>
      <button class="api-btn" onclick="testApiConnection()">Test Connection</button>
      <span class="api-status waiting" id="apiStatus">Waiting for key</span>
    </div>

    <!-- Main Grid -->
    <div class="main-grid">
      <!-- Image Panel -->
      <div class="image-panel">
        <!-- Upload Area -->
        <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
          <svg class="upload-icon"><use href="#i-upload"/></svg>
          <h3>Upload Your Photo</h3>
          <p>Drag & drop or click to select<br>Supports JPG, PNG, WEBP</p>
        </div>
        <input type="file" id="fileInput" accept="image/jpeg,image/png,image/webp" onchange="handleFileSelect(event)">

        <!-- Comparison View -->
        <div class="comparison-wrapper" id="comparisonWrapper">
          <div class="comparison-container" id="comparisonContainer">
            <img src="" alt="Original" class="comparison-image comparison-original" id="originalImage">
            <img src="" alt="Transformed" class="comparison-image comparison-transformed" id="transformedImage">
            <div class="comparison-slider" id="comparisonSlider"></div>
            <span class="comparison-label original">◊û◊ß◊ï◊®</span>
            <span class="comparison-label transformed" id="transformedLabel">◊ë◊ó◊® ◊°◊í◊†◊ï◊ü</span>

            <!-- Loading Overlay -->
            <div class="loading-overlay" id="loadingOverlay">
              <div class="spinner"></div>
              <span class="loading-text" id="loadingText">Processing...</span>
              <span class="loading-subtext">Nano Banana AI is working</span>
            </div>
          </div>

          <!-- Image Actions -->
          <div class="image-actions">
            <button class="btn-change" onclick="changeImage()">
              <svg style="width:16px;height:16px;vertical-align:middle;margin-left:4px"><use href="#i-refresh"/></svg>
              Change Photo
            </button>
            <button class="btn-download" id="downloadBtn" onclick="downloadImage()" disabled>
              <svg style="width:16px;height:16px;vertical-align:middle;margin-left:4px"><use href="#i-download"/></svg>
              Download
            </button>
          </div>
        </div>

        <!-- Error Message -->
        <div class="error-message" id="errorMessage"></div>

        <!-- Processing Info -->
        <div class="processing-info" id="processingInfo">
          <div class="stat">
            <span class="stat-label">Processing Time:</span>
            <span class="stat-value" id="statTime">-</span>
          </div>
          <div class="stat">
            <span class="stat-label">Style Applied:</span>
            <span class="stat-value" id="statStyle">-</span>
          </div>
        </div>
      </div>

      <!-- Styles Panel -->
      <div class="styles-panel">
        <h2>◊ë◊ó◊®◊ï ◊°◊í◊†◊ï◊ü ◊ê◊û◊†◊ï◊™</h2>
        <p>Click a style to transform your photo</p>

        <div class="style-grid" id="styleGrid">
          <!-- Styles will be generated by JavaScript -->
        </div>

        <div class="info-box">
          <strong>Nano Banana Test Mode</strong><br>
          Using <code>gemini-2.0-flash-exp</code> model.<br>
          Prompts optimized based on Google's official documentation.
        </div>
      </div>
    </div>
  </div>

  <script>
    /**
     * Nano Banana Style Configurations
     * Based on Google's official documentation and best practices:
     * - https://developers.googleblog.com/en/how-to-prompt-gemini-2-5-flash-image-generation-for-the-best-results/
     * - https://ai.google.dev/gemini-api/docs/image-generation
     */
    const STYLES = {
      'pop_art': {
        id: 'pop_art',
        nameHe: '◊§◊ï◊§ ◊ê◊®◊ò',
        nameEn: 'Pop Art',
        description: 'Bold colors, halftone dots',
        icon: 'i-zap',
        cssClass: 'style-pop-art',
        prompt: `Transform this photograph into the iconic Pop Art style of the 1960s, inspired by Andy Warhol and Roy Lichtenstein.

Render the subject with:
- Bold, flat areas of vibrant saturated color (hot pink, electric blue, bright yellow, orange)
- Visible halftone dot patterns in shadow areas, like printed comic books
- Strong black outlines defining shapes and features
- High contrast with simplified tonal areas
- Graphic, poster-like quality with clean color separations

Preserve the subject's likeness and facial features accurately. The final result should look like a screen-printed pop art portrait suitable for framing.`,
        cssFilter: 'saturate(2) contrast(1.3) brightness(1.1)'
      },
      'watercolor': {
        id: 'watercolor',
        nameHe: '◊¶◊ë◊¢◊ô ◊û◊ô◊ù',
        nameEn: 'Watercolor',
        description: 'Soft flowing colors',
        icon: 'i-droplet',
        cssClass: 'style-watercolor',
        prompt: `Transform this photograph into a delicate watercolor painting with the qualities of traditional wet-on-wet technique.

Apply these watercolor characteristics:
- Soft, flowing edges where colors blend naturally
- Translucent color washes that layer and overlap
- Visible paper texture showing through the paint
- Gentle color bleeding at the boundaries of shapes
- Light, airy quality with white highlights preserved
- Subtle variations in color intensity across the painting

Use a harmonious palette of soft, muted tones. Preserve the subject's likeness while giving the portrait an artistic, painterly quality. The result should look like a hand-painted watercolor portrait on quality watercolor paper.`,
        cssFilter: 'blur(0.5px) saturate(1.3) brightness(1.05)'
      },
      'line_art': {
        id: 'line_art',
        nameHe: '◊¶◊ô◊ï◊® ◊ß◊ï◊ï◊ô',
        nameEn: 'Line Art',
        description: 'Clean minimalist lines',
        icon: 'i-pen',
        cssClass: 'style-line-art',
        prompt: `Transform this photograph into a clean, minimalist line art drawing with elegant simplicity.

Create using these techniques:
- Clean, precise continuous lines of consistent weight
- Pure black lines on a white background
- No shading, hatching, or fill - only outlines
- Capture essential features and contours only
- Elegant, flowing line work with confident strokes
- Vector-like quality with smooth curves

Focus on the most defining features of the subject - eyes, nose, lips, and hair outline. Remove all unnecessary detail while maintaining the subject's recognizable likeness. The result should be a sophisticated, gallery-worthy line portrait.`,
        cssFilter: 'grayscale(1) contrast(2) brightness(1.2)'
      },
      'oil_painting': {
        id: 'oil_painting',
        nameHe: '◊¶◊ô◊ï◊® ◊©◊û◊ü',
        nameEn: 'Oil Painting',
        description: 'Rich classical brushstrokes',
        icon: 'i-brush',
        cssClass: 'style-oil-painting',
        prompt: `Transform this photograph into a classical oil painting reminiscent of Renaissance and Baroque portraiture masters.

Apply these oil painting characteristics:
- Thick, visible impasto brushstrokes with rich texture
- Deep, luminous colors with complex layering
- Dramatic chiaroscuro lighting with rich shadows
- Warm undertones in skin with subtle color variations
- Painterly blending while maintaining brushwork visibility
- Museum-quality finish with glazed depth

Render in the style of classical portraiture with attention to realistic proportions and dignified composition. Preserve the subject's likeness while elevating it to fine art quality. The result should appear as a masterwork suitable for a gallery or museum.`,
        cssFilter: 'saturate(1.5) contrast(1.2) brightness(0.95)'
      },
      'romantic': {
        id: 'romantic',
        nameHe: '◊®◊ï◊û◊†◊ò◊ô',
        nameEn: 'Romantic',
        description: 'Soft dreamy ethereal glow',
        icon: 'i-heart',
        cssClass: 'style-romantic',
        prompt: `Transform this photograph into a romantic, dreamy portrait with an ethereal, timeless quality.

Apply these romantic characteristics:
- Soft, diffused focus with gentle blur on edges
- Warm golden-hour lighting with soft highlights
- Delicate pink and peach tones in highlights
- Subtle lens flare or light bloom effects
- Smooth, luminous skin with soft gradients
- Dreamy, nostalgic atmosphere

Create a sense of warmth and tenderness. The lighting should feel like late afternoon golden hour. Preserve the subject's beauty while adding an idealized, romantic glow. The result should evoke emotion and feel like a treasured memory.`,
        cssFilter: 'sepia(0.3) saturate(1.2) brightness(1.1) contrast(0.95)'
      },
      'comic_book': {
        id: 'comic_book',
        nameHe: '◊ß◊ï◊û◊ô◊ß◊°',
        nameEn: 'Comic Book',
        description: 'Bold outlines, vibrant colors',
        icon: 'i-zap',
        cssClass: 'style-comic-book',
        prompt: `Transform this photograph into a dynamic comic book illustration in the classic American superhero comic style.

Apply these comic book characteristics:
- Bold, confident black outlines of varying thickness
- Flat areas of bright, saturated color
- Ben-Day dots or halftone patterns in shadows and midtones
- Strong contrast with dramatic lighting
- Dynamic, slightly exaggerated features
- Clean color separations without gradients

The style should reference classic Marvel or DC comic art with professional inking quality. Preserve the subject's likeness while adding heroic, dynamic energy. The result should look like a panel from a professionally printed comic book.`,
        cssFilter: 'saturate(1.8) contrast(1.4) brightness(1.05)'
      },
      'vintage': {
        id: 'vintage',
        nameHe: "◊ï◊ô◊†◊ò◊í'",
        nameEn: 'Vintage',
        description: 'Nostalgic sepia film grain',
        icon: 'i-film',
        cssClass: 'style-vintage',
        prompt: `Transform this photograph into a vintage, nostalgic portrait reminiscent of photographs from the 1970s era.

Apply these vintage characteristics:
- Warm sepia and amber color tones
- Visible film grain texture throughout
- Slightly faded highlights and lifted blacks
- Soft vignette darkening the edges
- Muted, desaturated color palette
- Subtle light leaks or color shifts at edges

The feeling should be of a treasured old photograph found in a family album. Add authentic analog film qualities while preserving the subject's likeness. The result should evoke nostalgia and timeless memories.`,
        cssFilter: 'sepia(0.6) saturate(0.8) contrast(1.1) brightness(0.95)'
      },
      'original_enhanced': {
        id: 'original_enhanced',
        nameHe: '◊û◊ß◊ï◊®◊ô ◊û◊©◊ï◊§◊®',
        nameEn: 'Enhanced',
        description: 'Professional color enhancement',
        icon: 'i-sun',
        cssClass: 'style-enhanced',
        prompt: `Enhance this photograph with professional photo editing while maintaining its natural, realistic appearance.

Apply these enhancements:
- Improved color vibrancy and saturation balance
- Enhanced contrast with preserved highlight and shadow detail
- Subtle sharpening of fine details
- Balanced exposure across the entire image
- Natural skin tone optimization
- Professional color grading for visual appeal

Do not apply any artistic filters or style transformations. The result should look like the same photograph but professionally retouched and color-corrected, suitable for printing and framing. Preserve the subject exactly as they appear, only improving technical quality.`,
        cssFilter: 'saturate(1.2) contrast(1.1) brightness(1.05)'
      }
    };

    // State
    let currentImageBase64 = null;
    let currentImageMimeType = null;
    let currentStyle = null;
    let isProcessing = false;
    let transformedImageBase64 = null;

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      renderStyleGrid();
      setupDragAndDrop();
      setupComparisonSlider();
    });

    // Render style grid
    function renderStyleGrid() {
      const grid = document.getElementById('styleGrid');
      grid.innerHTML = Object.values(STYLES).map(style => `
        <div class="style-card ${style.cssClass}" data-style="${style.id}" onclick="selectStyle('${style.id}')">
          <div class="style-icon">
            <svg><use href="#${style.icon}"/></svg>
          </div>
          <div class="style-name">${style.nameHe}</div>
          <div class="style-desc">${style.description}</div>
        </div>
      `).join('');
    }

    // Setup drag and drop
    function setupDragAndDrop() {
      const uploadArea = document.getElementById('uploadArea');

      uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
      });

      uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover');
      });

      uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith('image/')) {
          loadImage(file);
        }
      });
    }

    // Handle file select
    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (file) {
        loadImage(file);
      }
    }

    // Load image
    function loadImage(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        currentImageBase64 = e.target.result.split(',')[1];
        currentImageMimeType = file.type;

        document.getElementById('originalImage').src = e.target.result;
        document.getElementById('transformedImage').src = e.target.result;
        document.getElementById('uploadArea').classList.add('has-image');
        document.getElementById('comparisonWrapper').classList.add('visible');
        document.getElementById('transformedLabel').textContent = '◊ë◊ó◊® ◊°◊í◊†◊ï◊ü';
        document.getElementById('downloadBtn').disabled = true;
        transformedImageBase64 = null;

        // Reset slider
        updateSlider(50);
      };
      reader.readAsDataURL(file);
    }

    // Change image
    function changeImage() {
      document.getElementById('fileInput').click();
    }

    // Setup comparison slider
    function setupComparisonSlider() {
      const slider = document.getElementById('comparisonSlider');
      const container = document.getElementById('comparisonContainer');
      let isDragging = false;

      function updateSliderPosition(x) {
        const rect = container.getBoundingClientRect();
        let percent = ((x - rect.left) / rect.width) * 100;
        percent = Math.max(0, Math.min(100, percent));
        updateSlider(percent);
      }

      slider.addEventListener('mousedown', () => isDragging = true);
      document.addEventListener('mouseup', () => isDragging = false);
      document.addEventListener('mousemove', (e) => {
        if (isDragging) updateSliderPosition(e.clientX);
      });

      slider.addEventListener('touchstart', () => isDragging = true);
      document.addEventListener('touchend', () => isDragging = false);
      document.addEventListener('touchmove', (e) => {
        if (isDragging) updateSliderPosition(e.touches[0].clientX);
      });
    }

    function updateSlider(percent) {
      document.getElementById('comparisonSlider').style.left = percent + '%';
      document.getElementById('transformedImage').style.clipPath = `inset(0 0 0 ${percent}%)`;
    }

    // Select style
    async function selectStyle(styleId) {
      if (isProcessing) return;
      if (!currentImageBase64) {
        showError('Please upload an image first');
        return;
      }

      const apiKey = document.getElementById('apiKey').value;
      if (!apiKey) {
        showError('Please enter your Google AI API key');
        return;
      }

      currentStyle = styleId;
      const style = STYLES[styleId];

      // Update UI
      document.querySelectorAll('.style-card').forEach(card => {
        card.classList.remove('selected');
        if (card.dataset.style === styleId) {
          card.classList.add('selected');
        }
      });

      document.getElementById('transformedLabel').textContent = style.nameHe;

      // Transform
      await transformImage(style);
    }

    // Transform image
    async function transformImage(style) {
      isProcessing = true;
      const startTime = Date.now();

      showLoading(`◊û◊¢◊ë◊ì ◊ë◊°◊í◊†◊ï◊ü ${style.nameHe}...`);
      hideError();

      try {
        const apiKey = document.getElementById('apiKey').value;

        const response = await fetch(
          `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${apiKey}`,
          {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              contents: [{
                parts: [
                  {
                    inlineData: {
                      mimeType: currentImageMimeType,
                      data: currentImageBase64
                    }
                  },
                  { text: style.prompt }
                ]
              }],
              generationConfig: {
                responseModalities: ['TEXT', 'IMAGE'],
                temperature: 0.7
              }
            })
          }
        );

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error?.message || 'API request failed');
        }

        const data = await response.json();
        const elapsed = Date.now() - startTime;

        // Find image in response
        const parts = data.candidates?.[0]?.content?.parts || [];
        const imagePart = parts.find(p => p.inlineData?.data);

        if (imagePart) {
          const mimeType = imagePart.inlineData.mimeType || 'image/png';
          transformedImageBase64 = imagePart.inlineData.data;
          document.getElementById('transformedImage').src = `data:${mimeType};base64,${transformedImageBase64}`;
          document.getElementById('transformedImage').style.filter = 'none';
          document.getElementById('downloadBtn').disabled = false;

          // Show stats
          document.getElementById('statTime').textContent = `${(elapsed / 1000).toFixed(1)}s`;
          document.getElementById('statStyle').textContent = style.nameEn;
          document.getElementById('processingInfo').classList.add('show');

          console.log(`‚úÖ ${style.nameEn} transformation complete in ${elapsed}ms`);
        } else {
          throw new Error('No image in response');
        }

      } catch (error) {
        console.error('Transform error:', error);
        showError(`Transformation failed: ${error.message}`);

        // Apply CSS filter as fallback
        document.getElementById('transformedImage').style.filter = style.cssFilter;
      }

      hideLoading();
      isProcessing = false;
    }

    // Download image
    function downloadImage() {
      if (!transformedImageBase64) return;

      const link = document.createElement('a');
      link.href = `data:image/png;base64,${transformedImageBase64}`;
      link.download = `footprint-${currentStyle}-${Date.now()}.png`;
      link.click();
    }

    // Test API connection
    async function testApiConnection() {
      const apiKey = document.getElementById('apiKey').value;
      const statusEl = document.getElementById('apiStatus');

      if (!apiKey) {
        statusEl.textContent = 'No key';
        statusEl.className = 'api-status error';
        return;
      }

      statusEl.textContent = 'Testing...';
      statusEl.className = 'api-status waiting';

      try {
        const response = await fetch(
          `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp?key=${apiKey}`
        );

        if (response.ok) {
          statusEl.textContent = 'Nano Banana Ready';
          statusEl.className = 'api-status ready';
        } else {
          throw new Error('Invalid key');
        }
      } catch (error) {
        statusEl.textContent = 'Error';
        statusEl.className = 'api-status error';
        showError('API connection failed: ' + error.message);
      }
    }

    // UI Helpers
    function showLoading(text) {
      document.getElementById('loadingText').textContent = text;
      document.getElementById('loadingOverlay').classList.add('show');
    }

    function hideLoading() {
      document.getElementById('loadingOverlay').classList.remove('show');
    }

    function showError(message) {
      const el = document.getElementById('errorMessage');
      el.textContent = message;
      el.classList.add('show');
    }

    function hideError() {
      document.getElementById('errorMessage').classList.remove('show');
    }
  </script>
</body>
</html>
